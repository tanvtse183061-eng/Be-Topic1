{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://evdm.local/schemas/dto.schema.json",
  "title": "EVDM DTO Schemas (Single-file Bundle)",
  "type": "object",
  "$defs": {
    "UUID": { "type": "string", "format": "uuid" },
    "ISODate": { "type": "string", "pattern": "^\\\
d{4}-\\\
d{2}-\\\
d{2}$", "examples": ["2025-10-30"] },
    "ISODateTime": { "type": "string", "pattern": "^\\\
d{4}-\\\
d{2}-\\\
d{2}T\\\
d{2}:\\\
d{2}(:\\\
d{2})?$", "examples": ["2025-11-05T10:00:00"] },

    "QuotationRequest": {
      "type": "object",
      "required": ["customerId", "variantId", "basePrice"],
      "properties": {
        "customerId": { "$ref": "#/$defs/UUID" },
        "variantId": { "$ref": "#/$defs/UUID" },
        "basePrice": { "type": "number", "minimum": 0 },
        "discount": { "type": "number", "minimum": 0 },
        "tax": { "type": "number", "minimum": 0 },
        "validUntil": { "$ref": "#/$defs/ISODate" },
        "notes": { "type": "string", "maxLength": 2000 }
      },
      "additionalProperties": false
    },

    "OrderRequest": {
      "type": "object",
      "required": ["orderNumber", "quotationId", "customerId", "userId", "inventoryId", "orderDate"],
      "properties": {
        "orderNumber": { "type": "string", "minLength": 3, "maxLength": 100 },
        "quotationId": { "$ref": "#/$defs/UUID" },
        "customerId": { "$ref": "#/$defs/UUID" },
        "userId": { "$ref": "#/$defs/UUID" },
        "inventoryId": { "$ref": "#/$defs/UUID" },
        "orderDate": { "$ref": "#/$defs/ISODate" },
        "status": { "type": "string" },
        "orderType": { "type": "string", "enum": ["RETAIL", "FLEET"] },
        "paymentStatus": { "type": "string", "enum": ["PENDING", "PARTIAL", "PAID", "REFUNDED", "FAILED"] },
        "deliveryStatus": { "type": "string", "enum": ["PENDING", "SCHEDULED", "SHIPPED", "DELIVERED", "RETURNED"] },
        "fulfillmentStatus": { "type": "string" }
      },
      "additionalProperties": false
    },

    "CreateVehicleFromExistingRequest": {
      "type": "object",
      "required": ["existingBrandId", "existingModelId", "existingColorId", "existingWarehouseId", "variant", "inventory"],
      "properties": {
        "existingBrandId": { "type": "integer", "minimum": 1 },
        "existingModelId": { "type": "integer", "minimum": 1 },
        "existingColorId": { "type": "integer", "minimum": 1 },
        "existingWarehouseId": { "type": "string" },
        "variant": {
          "type": "object",
          "required": ["variantName"],
          "properties": {
            "variantName": { "type": "string", "minLength": 2, "maxLength": 255 },
            "priceBase": { "type": "number", "minimum": 0 },
            "batteryKwh": { "type": "number", "minimum": 0 },
            "rangeKm": { "type": "number", "minimum": 0 }
          },
          "additionalProperties": true
        },
        "inventory": {
          "type": "object",
          "required": ["vin"],
          "properties": {
            "vin": { "type": "string", "minLength": 10, "maxLength": 32 },
            "warehouseLocation": { "type": "string", "maxLength": 255 },
            "stockStatus": { "type": "string" },
            "sellingPrice": { "type": "number", "minimum": 0 },
            "notes": { "type": "string", "maxLength": 2000 }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },

    "PublicCustomerRequest": {
      "type": "object",
      "required": ["firstName", "lastName"],
      "properties": {
        "firstName": { "type": "string", "minLength": 1, "maxLength": 100 },
        "lastName": { "type": "string", "minLength": 1, "maxLength": 100 },
        "email": { "type": "string", "format": "email" },
        "phone": { "type": "string", "minLength": 9, "maxLength": 20 }
      },
      "allOf": [ { "anyOf": [ { "required": ["email"] }, { "required": ["phone"] } ] } ],
      "additionalProperties": false
    },

    "PublicPaymentRequest": {
      "type": "object",
      "required": ["orderId", "amount", "currency", "method"],
      "properties": {
        "orderId": { "$ref": "#/$defs/UUID" },
        "amount": { "type": "number", "minimum": 0 },
        "currency": { "type": "string", "minLength": 3, "maxLength": 3 },
        "method": { "type": "string", "enum": ["CARD", "BANK_TRANSFER", "CASH", "WALLET"] },
        "cardLast4": { "type": "string", "pattern": "^\\d{4}$" },
        "returnUrl": { "type": "string", "format": "uri" }
      },
      "additionalProperties": false
    },

    "DealerPaymentProcessRequest": {
      "type": "object",
      "required": ["dealerId", "orderId", "amount", "currency", "method"],
      "properties": {
        "dealerId": { "$ref": "#/$defs/UUID" },
        "orderId": { "$ref": "#/$defs/UUID" },
        "amount": { "type": "number", "minimum": 0 },
        "currency": { "type": "string", "minLength": 3, "maxLength": 3 },
        "method": { "type": "string", "enum": ["BANK_TRANSFER", "CASH", "CARD"] },
        "reference": { "type": "string", "maxLength": 100 },
        "notes": { "type": "string", "maxLength": 2000 }
      },
      "additionalProperties": false
    },

    "AppointmentRequest": {
      "type": "object",
      "required": ["customerName", "preferredDateTime"],
      "properties": {
        "customerName": { "type": "string", "minLength": 1, "maxLength": 100 },
        "email": { "type": "string", "format": "email" },
        "phone": { "type": "string", "minLength": 9, "maxLength": 20 },
        "variantId": { "type": ["integer", "string"] },
        "inventoryId": { "$ref": "#/$defs/UUID" },
        "preferredDateTime": { "$ref": "#/$defs/ISODateTime" },
        "notes": { "type": "string", "maxLength": 1000 }
      },
      "additionalProperties": false
    },

    "FeedbackRequest": {
      "type": "object",
      "required": ["subject", "message", "rating"],
      "properties": {
        "subject": { "type": "string", "minLength": 3, "maxLength": 200 },
        "message": { "type": "string", "minLength": 3, "maxLength": 5000 },
        "rating": { "type": "integer", "minimum": 1, "maximum": 5 },
        "customerId": { "$ref": "#/$defs/UUID" },
        "contactEmail": { "type": "string", "format": "email" }
      },
      "additionalProperties": false
    },

    "InventoryStatusUpdateRequest": {
      "type": "object",
      "required": ["status"],
      "properties": { "status": { "type": "string" } },
      "additionalProperties": false
    },

    "UserRequest": {
      "type": "object",
      "required": ["username", "email", "password", "firstName", "lastName"],
      "properties": {
        "username": { "type": "string", "minLength": 3, "maxLength": 100 },
        "email": { "type": "string", "format": "email" },
        "password": { "type": "string", "minLength": 8, "maxLength": 128 },
        "firstName": { "type": "string", "minLength": 1, "maxLength": 100 },
        "lastName": { "type": "string", "minLength": 1, "maxLength": 100 },
        "phone": { "type": "string", "minLength": 9, "maxLength": 20 },
        "dealerId": { "$ref": "#/$defs/UUID" },
        "userType": { "type": "string", "enum": ["ADMIN", "EVM_STAFF", "DEALER_STAFF", "CUSTOMER_SUPPORT"] },
        "status": { "type": "string", "enum": ["ACTIVE", "INACTIVE", "LOCKED"] }
      },
      "additionalProperties": false
    },

    "ResetPasswordRequest": {
      "type": "object",
      "required": ["newPassword"],
      "properties": { "newPassword": { "type": "string", "minLength": 8, "maxLength": 128 } },
      "additionalProperties": false
    }
  }
}


